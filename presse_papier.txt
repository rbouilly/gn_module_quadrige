installation üëç


Installation manuelle
Installation du backend

Installer le module avec pip en mode √©ditable apr√®s avoir activ√© le venv de GeoNature, puis relancer GeoNature :

source ~/geonature/backend/venv/bin/activate
pip install --editable <dossier du module>
sudo systemctl restart geonature
Installation du frontend

Cr√©er un lien symbolique dans le dossier frontend/external_modules de GeoNature vers le dossier frontend du module. Le lien symbolique doit √™tre nomm√© suivant le code du module en minuscule :

cd ~/geonature/frontend/external_modules/
ln -s <dossier du module>/frontend <code du module en minuscule>
Exemple pour le module Import :

cd ~/geonature/frontend/external_modules/
ln -s ~/gn_module_import/frontend import
Re-builder le frontend :

cd ~/geonature/frontend/
nvm use
npm run build
Installation de la base de donn√©es

source ~/geonature/backend/venv/bin/activate
geonature upgrade-modules-db <code du module>
Configuration du module
De mani√®re facultative, vous pouvez modifier la configuration du module. Pour cela, vous pouvez cr√©er un fichier de configuration dans le dossier config de GeoNature en le nommant <code du module en minuscule>_config.toml. La plupart des modules fournissent un fichier d‚Äôexemple <module-code>_config.toml.example dans leur dossier racine dont vous pouvez vous inspirer.

Apr√®s cr√©ation de ce fichier, activez le rechargement automatique de GeoNature lors des modifications du fichier en lan√ßant les commandes suivantes :

sudo systemctl daemon-reload
sudo systemctl restart geonature
Avant la version 2.12.0 de GeoNature, apr√®s chaque modification de la configuration du module, vous devez recharger GeoNature manuellement :

sudo systemctl reload geonature
Mise √† jour du module
D√©placer le code de l‚Äôancienne version du module : mv gn_module_xxx gn_module_xxx_old

T√©l√©charger et d√©sarchiver la nouvelle version du module, et renommer son dossier afin qu‚Äôil porte le m√™me nom qu‚Äôavant (e.g. gn_module_xxx)

(Optionnel) Si le fichier de configuration du module est encore plac√© avec celui-ci, le d√©placer dans la dossier de configuration centralis√©e de GeoNature : cp gn_module_xxx_old/config/conf_gn_module.toml geonature/config/<mode-code>_config.toml

Relancer l‚Äôinstallation du module : geonature install-gn-module gn_module_xxx XXX && sudo systemctl reload geonature

Mise √† jour de l‚Äôapplication
Avertissement

Avant chaque mise √† jour de GeoNature, il est important de sauvegarder l‚Äôapplication et sa base de donn√©es, ou de faire un snapshot du serveur pour pouvoir revenir √† son √©tat ant√©rieure avant mise √† jour, en cas de probl√®me.

Avertissement

V√©rifiez pr√©alablement la compatibilit√© des modules que vous utilisez avant de mettre GeoNature √† jour. S‚Äôil est n√©cessaire de les mettre √† jour, arr√™tez vous apr√®s le remplacement du dossier par le nouveau code source (et la r√©cup√©ration √©ventuelle de la configuration); le script de migration de GeoNature s‚Äôoccupera automatiquement d‚Äôinstaller la nouvelle version du module.

La mise √† jour de GeoNature consiste √† t√©l√©charger sa nouvelle version dans un nouveau r√©pertoire, r√©cup√©rer les fichiers de configuration et de surcouche, ainsi que les m√©dias depuis la version actuelle et de relancer l‚Äôinstallation dans le r√©pertoire de la nouvelle version.

La mise √† jour doit √™tre r√©alis√©e avec votre utilisateur linux courant (geonatureadmin par exemple) et non pas le super-utilisateur root.

T√©l√©charger la derni√®re version de GeoNature :

wget https://github.com/PnX-SI/GeoNature/archive/X.Y.Z.zip
unzip X.Y.Z.zip
rm X.Y.Z.zip
Renommer l‚Äôancien repertoire de l‚Äôapplication, ainsi que le nouveau :

mv ~/geonature/ ~/geonature_old/
mv ~/GeoNature-X.Y.Z ~/geonature/
cd ~/geonature
Suivez les √©ventuelles notes de version sp√©cifiques d√©crites au niveau de chaque version : https://github.com/PnX-SI/GeoNature/releases.

Sauf mentions contraires dans les notes de version, vous pouvez sauter des versions mais en suivant bien les diff√©rentes notes de versions interm√©diaires.

Si vous devez aussi mettre √† jour UsersHub, suivez ses notes de version et sa documentation (https://usershub.readthedocs.io).

Lancez le script de migration.sh √† la racine du dossier geonature:

./install/migration/migration.sh 2>&1 | tee install/migration/migration.log
Depuis la version 2.12, le script migration.sh peut prendre en argument le chemin vers l‚Äôancien dossier d‚Äôinstallation de GeoNature. Il peut s‚Äôagir du m√™me dossier que la nouvelle installation de GeoNature. Cela permet d‚Äôutiliser ce script si la nouvelle version de GeoNature est dans le m√™me dossier et donc de g√©rer le cas o√π GeoNature est install√© et mis √† jour avec git.

Dans ce cas, les commandes √† ex√©cuter sont :

cd ~/GeoNature
git status # optionnel, pour connaitre l'√©tat et la version ou branche actuellement utilis√©e
git fetch
git checkout X.Y.Z # o√π X.Y.Z est le num√©ro du tag de la version vers laquelle faire la mise √† jour, ou le nom de la branche √† utiliser
git submodule update # ou "git config submodule.recurse true" lanc√© une seule fois, pour que la mise √† jour des sous-modules soit relanc√©e automatiquement √† chaque "git pull"
./install/migration/migration.sh .




tests :



python -c "import pkg_resources; print([ep.name for ep in pkg_resources.iter_entry_points('gn_module')])"
pip list | grep gn_module_quadrige
pip show gn_module_quadrige


pip uninstall gn_module_quadrige
pip uninstall gn_module_quadrige   # parfois n√©cessaire 2 ou 3 fois






